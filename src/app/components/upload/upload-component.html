<div class="upload-container">
  <div class="upload-header">
    <h2>📤 Téléchargement de Documents</h2>
    <p>Formats acceptés: PDF, DOCX, TXT</p>
  </div>

  <!-- Configuration Section -->
  <div class="config-section">
    <h3>⚙️ Configuration</h3>
    
    <!-- API Key Input -->
    <div class="form-group">
      <label for="apiKey" class="form-label">
        <span class="label-text">Clé API Dify</span>
        <span class="label-required">*</span>
      </label>
      <div class="input-wrapper">
        <input
          id="apiKey"
          type="password"
          [(ngModel)]="apiKey"
          placeholder="app-xxxxxxxxxxxxxxxxxxxxxxxxx"
          class="form-input"
          required
        />
        <button 
          type="button" 
          class="toggle-visibility-btn"
          (click)="toggleApiKeyVisibility()"
          [title]="showApiKey() ? 'Masquer la clé' : 'Afficher la clé'"
        >
          {{ showApiKey() ? '🙈' : '👁️' }}
        </button>
      </div>
      <div class="form-help">
        Votre clé API Dify pour authentifier les requêtes. 
        <a href="https://docs.dify.ai/getting-started/install-self-hosted/docker-compose#access-your-dify-instance" target="_blank" class="help-link">
          Comment obtenir votre clé API ?
        </a>
      </div>
    </div>

    <!-- User ID Input -->
    <div class="form-group">
      <label for="userId" class="form-label">
        <span class="label-text">Identifiant utilisateur</span>
        <span class="label-required">*</span>
      </label>
      <input
        id="userId"
        type="text"
        [(ngModel)]="userId"
        placeholder="user-123"
        class="form-input"
        required
      />
      <div class="form-help">
        Identifiant unique pour associer les fichiers à votre session.
      </div>
    </div>

    <!-- Connection Status -->
    <div class="connection-status">
      @if (apiKey() && userId()) {
        <div class="status-indicator success">
          <span class="status-icon">✅</span>
          <span>Configuration complète</span>
        </div>
      } @else {
        <div class="status-indicator warning">
          <span class="status-icon">⚠️</span>
          <span>Veuillez remplir tous les champs requis</span>
        </div>
      }
    </div>
  </div>

  <!-- Upload Zone -->
  <div 
    class="upload-zone"
    [class.drag-over]="isDragOver()"
    [class.disabled]="!apiKey() || !userId()"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
    (click)="onUploadZoneClick()"
  >
    <div class="upload-content">
      @if (apiKey() && userId()) {
        <div class="upload-icon">📁</div>
        <h3>Glissez-déposez vos fichiers ici</h3>
        <p>ou cliquez pour sélectionner</p>
        <div class="supported-formats">
          <span class="format-badge">PDF</span>
          <span class="format-badge">DOCX</span>
          <span class="format-badge">TXT</span>
        </div>
      } @else {
        <div class="upload-icon disabled">🔒</div>
        <h3>Configuration requise</h3>
        <p>Veuillez remplir la clé API et l'identifiant utilisateur ci-dessus</p>
      }
    </div>
  </div>

  <!-- Hidden File Input -->
  <input
    #fileInput
    type="file"
    multiple
    accept=".pdf,.docx,.doc,.txt"
    (change)="onFileSelect($event)"
    style="display: none;"
  />

  <!-- Uploaded Files List -->
  @if (uploadedFiles().length > 0) {
    <div class="files-section">
      <div class="files-header">
        <h3>📋 Fichiers téléchargés ({{ uploadedFiles().length }})</h3>
        <button 
          class="clear-all-btn"
          (click)="clearAllFiles()"
          type="button"
        >
          🗑️ Tout supprimer
        </button>
      </div>

      <div class="files-list">
        @for (file of uploadedFiles(); track $index) {
          <div class="file-item" [class]="file.status">
            <div class="file-info">
              <span class="file-icon">{{ getFileIcon(file.file.name) }}</span>
              <div class="file-details">
                <div class="file-name">{{ file.file.name }}</div>
                <div class="file-size">{{ formatFileSize(file.file.size) }}</div>
                @if (file.id) {
                  <div class="file-id">ID: {{ file.id }}</div>
                }
              </div>
            </div>

            <div class="file-status">
              @switch (file.status) {
                @case ('uploading') {
                  <div class="progress-container">
                    <div class="progress-bar">
                      <div 
                        class="progress-fill" 
                        [style.width.%]="file.progress"
                      ></div>
                    </div>
                    <span class="progress-text">{{ file.progress }}%</span>
                  </div>
                }
                @case ('success') {
                  <div class="status-success">
                    <span class="status-icon">✅</span>
                    <span>Téléchargé</span>
                  </div>
                }
                @case ('error') {
                  <div class="status-error">
                    <span class="status-icon">❌</span>
                    <span>{{ file.errorMessage || 'Erreur' }}</span>
                  </div>
                }
              }
            </div>

            <button 
              class="remove-btn"
              (click)="removeFile($index)"
              type="button"
              title="Supprimer le fichier"
            >
              ✕
            </button>
          </div>
        }
      </div>

      <!-- Summary -->
      @if (getSuccessfulUploads().length > 0) {
        <div class="upload-summary">
          <div class="summary-item">
            <span class="summary-label">Fichiers réussis:</span>
            <span class="summary-value">{{ getSuccessfulUploads().length }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Prêt pour traitement:</span>
            <span class="summary-value success">✅</span>
          </div>
        </div>
      }
    </div>
  }
</div>